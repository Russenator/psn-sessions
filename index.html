<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sitzungsplaner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
body { font-family:'Inter',sans-serif; background:#eef3ff; margin:0; padding:20px; color:#222; }
h1 { text-align:center; margin-bottom:20px; }
.card { background:#fff; padding:20px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1); max-width:600px; margin:20px auto; }
.form-row { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
input, select, button { padding:8px; border-radius:8px; border:1px solid #ccc; flex:1 1 150px; }
button { cursor:pointer; background:#4a8bff; color:white; border:none; font-weight:bold; }
.list-item { background:#f1f4ff; padding:12px; border-radius:12px; margin:10px 0; display:flex; justify-content:space-between; align-items:center; }
.delete-btn { background:#ff4a4a; border:none; color:white; border-radius:50%; width:28px; height:28px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
</style>
</head>
<body>

<h1>Sitzungsplaner</h1>

<div class="card">
  <h2>Neue Sitzung</h2>
  <div class="form-row">
    <input id="name" placeholder="Name (PSN)">
    <input id="game" placeholder="Spiel">
  </div>
  <div class="form-row">
    <input id="dateFrom" placeholder="Startdatum">
    <input id="dateTo" placeholder="Enddatum">
  </div>
  <div class="form-row">
    <input id="timeStart" type="time" placeholder="Startzeit">
    <input id="timeEnd" type="time" placeholder="Endzeit">
    <input id="tzoffset" placeholder="UTC Offset" readonly>
    <button onclick="addSession()">Speichern</button>
  </div>
</div>

<div class="card">
  <h2>Sitzungsübersicht</h2>
  <div id="list">Wird geladen...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = { 
  apiKey:"AIzaSyBu7TsiZAGJ7kQ8piqfrsyUFalEOM8eSGU", 
  authDomain:"psn-planen.firebaseapp.com", 
  projectId:"psn-planen" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const colRef = db.collection("sessions");
const ADMIN_KEY = "MEIN_GEHEIM_KEY";
let isAdmin = false;

// Flatpickr initialisieren
window.addEventListener('load', async ()=>{
  flatpickr("#dateFrom",{ dateFormat:"Y-m-d", altInput:true, altFormat:"d.m.Y", allowInput:true, locale:navigator.language });
  flatpickr("#dateTo",{ dateFormat:"Y-m-d", altInput:true, altFormat:"d.m.Y", allowInput:true, locale:navigator.language });
  document.getElementById('tzoffset').value = new Date().getTimezoneOffset()/-60;
  await loadSessions();
});

async function addSession(){
  const name=document.getElementById('name').value;
  const game=document.getElementById('game').value;
  const from=document.getElementById('dateFrom')._flatpickr.input.value;
  const to=document.getElementById('dateTo')._flatpickr.input.value;
  const start=document.getElementById('timeStart').value;
  const end=document.getElementById('timeEnd').value;
  const tz=document.getElementById('tzoffset').value;
  if(!name||!game||!from||!to||!start||!end){ alert("Bitte alle Felder ausfüllen"); return; }
  await colRef.add({name,game,from,to,start,end,tz});
  await loadSessions();
}

async function loadSessions(){
  const list=document.getElementById('list');
  list.innerHTML="";
  const snapshot=await colRef.get();
  if(snapshot.empty){ list.innerHTML="Keine Sitzungen"; return; }
  snapshot.forEach(doc=>{
    const s=doc.data();
    list.innerHTML+=`<div class="list-item"><div><b>${s.name}</b> – ${s.game}<br>${s.from} → ${s.to}<br>${s.start}–${s.end} (UTC${s.tz})</div><button class="delete-btn" onclick="deleteSession('${doc.id}')">×</button></div>`;
  });
}

// Admin-Key nur beim Löschen abfragen
async function deleteSession(id){ 
  const key = prompt("Admin-Schlüssel zum Löschen:");
  if(key!==ADMIN_KEY){ alert("Falscher Schlüssel!"); return; }
  await colRef.doc(id).delete(); 
  await loadSessions(); 
}
</script>
</body>
</html>
