<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Current Sessions</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* ... Dein Style bleibt hier unver√§ndert ... */
  </style>
</head>
<body>
  <h1>Current Sessions</h1>
  <button class="theme-toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

  <!-- Add New Session -->
  <div class="card">
    <h2>Add New Session</h2>
    <div class="form-row">
      <input id="name" placeholder="Name (PSN)" />
      <input id="game" placeholder="Game" />
      <input id="timerange" placeholder="Time (e.g., 8-12)" />
    </div>
    <div class="form-row">
      <input id="date" placeholder="Select Date" />
      <input id="tzoffset" placeholder="UTC offset" />
      <button class="submit" onclick="addSession()">Save</button>
    </div>
  </div>

  <!-- Availability List -->
  <div class="card">
    <h2>Availability List</h2>
    <div id="list">Loading...</div>
  </div>

  <!-- Firebase COMPAT SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    const ADMIN_KEY = "MEIN_GEHEIM_KEY";  // Ersetze durch deinen eigenen Admin-Schl√ºssel
    let isAdmin = false;

    // Beim Laden fragt der Browser nach Admin-Key
    window.addEventListener('load', () => {
      const key = prompt("Admin-Key eingeben (nur falls du l√∂schen willst):");
      if (key === ADMIN_KEY) {
        isAdmin = true;
      }

      loadSessions();  // Lade Sitzungen nach Admin-Abfrage
    });

    const firebaseConfig = {
      apiKey: "AIzaSyBu7TsiZAGJ7kQ8piqfrsyUFalEOM8eSGU",
      authDomain: "psn-planen.firebaseapp.com",
      projectId: "psn-planen",
      storageBucket: "psn-planen.firebasestorage.app",
      messagingSenderId: "1089591052960",
      appId: "1:1089591052960:web:069c515084f2105b22d7c5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const listEl = document.getElementById("list");

    // Theme Toggle
    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    // Sitzungen laden
    async function loadSessions() {
      const snapshot = await db.collection('entries').get();

      // Pr√ºfen, ob Daten aus Firebase kommen
      console.log('Daten aus Firebase:', snapshot.docs.map(doc => doc.data()));

      listEl.innerHTML = '';  // Leere die aktuelle Liste

      if (snapshot.empty) {
        listEl.innerHTML = 'Keine Sitzungen gefunden.';
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const { name, game, timerange, tzoffset, date } = data;
        const [from, to] = parseTimeRange(timerange);
        const visitorFrom = convertToVisitorTime(from.h, from.m, tzoffset);
        const visitorTo = convertToVisitorTime(to.h, to.m, tzoffset);

        let formattedDate = '';
        if (date) {
          formattedDate = new Date(date).toLocaleDateString(navigator.language);
        }

        const item = document.createElement('div');
        item.className = 'list-item';

        const deleteBtnHTML = isAdmin ? `<button class="delete-btn" onclick="deleteSession('${doc.id}')">X</button>` : '';

        item.innerHTML = `
          <div class="item-content">
            <div>
              <strong>${name}</strong> ‚Äî ${game}<br>
              Date: ${formattedDate}<br>
              User Time: ${timerange} (UTC${tzoffset >= 0 ? '+' : ''}${tzoffset})<br>
              Local Time: <b>${formatTime(visitorFrom)} - ${formatTime(visitorTo)}</b>
            </div>
            ${deleteBtnHTML}
          </div>
        `;
        listEl.appendChild(item);
      });
    }

    // Hilfsfunktionen (z.B. parseTimeRange, formatTime, convertToVisitorTime) bleiben unver√§ndert

  </script>
</body>
</html>
