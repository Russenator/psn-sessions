<script>
// Admin-Key: ändere MEIN_GEHEIM_KEY zu deinem eigenen starken Schlüssel
const ADMIN_KEY = "MEIN_GEHEIM_KEY";
let isAdmin = false;

// Beim Laden fragt der Browser nach Admin-Key
window.addEventListener('load', () => {
  const key = prompt("Admin-Key eingeben (nur falls du löschen willst):");
  if(key === ADMIN_KEY) {
    isAdmin = true;
  }
});

// Delete Session mit Admin-Check
async function deleteSession(id) {
  if(!isAdmin) {
    alert("Nur der Admin kann Sessions löschen!");
    return;
  }
  await db.collection('entries').doc(id).delete();
  loadSessions();
}

// Sessions laden
async function loadSessions() {
  const snapshot = await db.collection('entries').get();
  listEl.innerHTML = '';
  if(snapshot.empty) {
    listEl.innerHTML = '<div class="empty-text">No sessions available.</div>';
    return;
  }
  snapshot.forEach(doc => {
    const data = doc.data();
    const { name, game, timerange, tzoffset, date } = data;
    const [from, to] = parseTimeRange(timerange);
    const visitorFrom = convertToVisitorTime(from.h, from.m, tzoffset);
    const visitorTo = convertToVisitorTime(to.h, to.m, tzoffset);

    // Datum automatisch in lokaler Sprache
    let formattedDate = '';
    if(date) {
      formattedDate = new Date(date).toLocaleDateString(navigator.language);
    }

    const item = document.createElement('div');
    item.className = 'list-item';
    
    // Delete-Button nur anzeigen, wenn Admin
    const deleteBtnHTML = isAdmin ? `<button class="delete-btn" onclick="deleteSession('${doc.id}')">X</button>` : '';
    
    item.innerHTML = `
      <div class="item-content">
        <div>
          <strong>${name}</strong> — ${game}<br>
          Date: ${formattedDate}<br>
          User Time: ${timerange} (UTC${tzoffset>=0?'+':''}${tzoffset})<br>
          Local Time: <b>${formatTime(visitorFrom)} - ${formatTime(visitorTo)}</b>
        </div>
        ${deleteBtnHTML}
      </div>
    `;
    listEl.appendChild(item);
  });
}
</script>
