<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sitzungsplaner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
body { font-family:'Inter',sans-serif; background:#eef3ff; margin:0; padding:20px; color:#222; transition: background 0.3s, color 0.3s; }
h1 { text-align:center; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; }
.tabs { display:flex; justify-content:center; margin:20px 0; gap:10px; }
.tab { padding:10px 20px; border-radius:12px; cursor:pointer; background:#4a8bff; color:#fff; font-weight:bold; display:flex; align-items:center; gap:6px; }
.tab.active { background:#2f6edb; }
.card { background:#fff; padding:24px; border-radius:20px; box-shadow:0 6px 20px rgba(0,0,0,0.1); max-width:650px; margin:20px auto; transition: all 0.3s; }
.form-row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
input, select { flex:1 1 150px; padding:8px; border-radius:10px; border:1px solid #ccc; }
.submit { padding:10px 18px; background:#4a8bff; border:none; color:#fff; border-radius:10px; cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:6px; }
.list-item { background:#f1f4ff; padding:14px; border-radius:12px; margin:12px 0; border:1px solid #dce3f5; display:flex; justify-content:space-between; align-items:center; transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s; opacity:0; }
.list-item.show { opacity:1; transform: translateY(0); }
.list-item:hover { transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.delete-btn { background:#ff4a4a; border:none; color:white; font-size:14px; border-radius:50%; width:32px; height:32px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.dark { background:#1a1a1a; color:#eaeaea; }
.dark .card { background:#262626; }
.dark input, .dark select { background:#262626; border:1px solid #555; color:white; }
.dark .list-item { background:#333; border-color:#555; }
</style>
</head>
<body>
<h1>
<i class="fas fa-calendar"></i> Sitzungsplaner
<select id="langSwitch" onchange="switchLanguage()" style="padding:6px;border-radius:8px;">
<option value="auto">Auto</option>
<option value="de">Deutsch</option>
<option value="en">Englisch</option>
</select>
<button id="darkBtn" style="padding:6px 12px;border-radius:8px;cursor:pointer;">ðŸŒ“</button>
</h1>
<div class="tabs">
<div class="tab active" data-tab="create" onclick="switchTab(event)"><i class="fas fa-plus"></i> Sitzung erstellen</div>
<div class="tab" data-tab="list" onclick="switchTab(event)"><i class="fas fa-list"></i> SitzungsÃ¼bersicht</div>
</div>
<div class="card" id="tab-create">
<h2>Neue Sitzung erstellen</h2>
<div class="form-row">
<input id="name" placeholder="Name (PSN)" />
<input id="game" placeholder="Spiel" />
</div>
<div class="form-row">
<input id="dateFrom" type="text" placeholder="Startdatum" />
<input id="dateTo" type="text" placeholder="Enddatum" />
</div>
<div class="form-row">
<input id="timeStart" placeholder="Startzeit" />
<input id="timeEnd" placeholder="Endzeit" />
<input id="tzoffset" placeholder="UTC Offset" />
</div>
<button class="submit" onclick="addSession()"><i class="fas fa-save"></i> Speichern</button>
</div>
<div class="card" id="tab-list" style="display:none;">
<h2>SitzungsÃ¼bersicht</h2>
<div id="list">Wird geladen...</div>
<button class="submit" style="background:#ff4a4a;margin-top:10px;" onclick="deleteAll()"><i class="fas fa-trash"></i> Alle lÃ¶schen</button>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, doc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = { apiKey: "AIzaSyBu7TsiZAGJ7kQ8piqfrsyUFalEOM8eSGU", authDomain: "psn-planen.firebaseapp.com", projectId: "psn-planen", storageBucket: "psn-planen.firebasestorage.app", messagingSenderId: "1089591052960", appId: "1:1089591052960:web:069c515084f2105b22d7c5" };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const colRef = collection(db, "sessions");
let isAdmin = false;
const ADMIN_KEY = "MEIN_GEHEIM_KEY";

function switchTab(e){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); e.currentTarget.classList.add('active'); const tab=e.currentTarget.dataset.tab; document.getElementById('tab-create').style.display=tab==='create'?'block':'none'; document.getElementById('tab-list').style.display=tab==='list'?'block':'none'; }
function toggleDark(){ document.body.classList.toggle('dark'); }
document.getElementById('darkBtn').addEventListener('click', toggleDark);
window.switchLanguage = function(){ const sel=document.getElementById('langSwitch').value; let lang= sel==='auto'? navigator.language: sel; document.documentElement.lang = lang.startsWith('de')? 'de':'en'; }

// Flatpickr fÃ¼r Datum
function initFlatpickr(){
  import('https://cdn.jsdelivr.net/npm/flatpickr').then(fp=>{
    fp.default('#dateFrom',{ dateFormat:'Y-m-d', altInput:true, altFormat:'d.m.Y', locale:navigator.language, allowInput:true });
    fp.default('#dateTo',{ dateFormat:'Y-m-d', altInput:true, altFormat:'d.m.Y', locale:navigator.language, allowInput:true });
  }).catch(e=>console.error(e));
}
window.addEventListener('load',()=>{ initFlatpickr(); loadSessions(); });

// Load Sessions
async function loadSessions(){
  const list = document.getElementById('list'); list.innerHTML='';
  try{
    const snap = await getDocs(colRef);
    if(snap.empty){ list.innerHTML='Keine Sitzungen verfÃ¼gbar.'; return; }
    snap.forEach(docu=>{
      const s=docu.data();
      const item=document.createElement('div');
      item.className='list-item';
      item.innerHTML=`<div><b>${s.name}</b> â€“ ${s.game}<br>${new Date(s.from).toLocaleDateString(navigator.language)} â†’ ${new Date(s.to).toLocaleDateString(navigator.language)}<br>${s.start}-${s.end} (UTC${s.tz})</div>${s.isAdmin?`<button class="delete-btn">Ã—</button>`:''}`;
      if(isAdmin){ item.querySelector('.delete-btn').addEventListener('click',()=>{ if(confirm('Admin-Key eingeben:')) deleteSession(docu.id); }); }
      list.appendChild(item);
      setTimeout(()=>item.classList.add('show'),50);
    });
  } catch(e){ console.error(e); list.innerHTML='Fehler beim Laden der Sitzungen.'; }
}

// Add Session
async function addSession(){
  const name=document.getElementById('name').value;
  const game=document.getElementById('game').value;
  const from=document.getElementById('dateFrom')._flatpickr.input.value;
  const to=document.getElementById('dateTo')._flatpickr.input.value;
  const start=document.getElementById('timeStart').value;
  const end=document.getElementById('timeEnd').value;
  const tz=document.getElementById('tzoffset').value;
  if(!name||!game||!from||!to||!start||!end||!tz){ alert('Bitte alle Felder ausfÃ¼llen inklusive UTC Offset'); return; }
  await addDoc(colRef,{name,game,from,to,start,end,tz});
  loadSessions();
}

// Delete
async function deleteSession(id){
  const key=prompt('Admin-Key zum LÃ¶schen eingeben:');
  if(key!==ADMIN_KEY){ alert('Falscher Key!'); return; }
  await deleteDoc(doc(db,'sessions',id));
  loadSessions();
}
window.deleteAll = async function(){ const key=prompt('Admin-Key zum LÃ¶schen eingeben:'); if(key!==ADMIN_KEY){ alert('Falscher Key!'); return; } const snap = await getDocs(colRef); for(const d of snap.docs) await deleteDoc(doc(db,'sessions',d.id)); loadSessions(); }
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</body>
</html>
