<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sitzungsplaner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
<style>
body { font-family:'Inter',sans-serif; background:#eef3ff; margin:0; padding:20px; color:#222; transition: 0.3s; }
h1 { text-align:center; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; }
.card { background:#fff; padding:24px; border-radius:20px; box-shadow:0 6px 20px rgba(0,0,0,0.1); max-width:650px; margin:20px auto; transition: all 0.3s; }
.form-row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
input { flex:1 1 150px; padding:8px; border-radius:10px; border:1px solid #ccc; transition:0.2s; }
input:focus { border-color:#4a8bff; outline:none; }
.submit { padding:10px 18px; background:#4a8bff; border:none; color:#fff; border-radius:10px; cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:6px; transition:0.2s; }
.submit:hover { background:#2f6edb; }
.list-item { background:#f1f4ff; padding:14px; border-radius:12px; margin:12px 0; border:1px solid #dce3f5; display:flex; justify-content:space-between; align-items:center; transition: transform 0.2s, box-shadow 0.2s; }
.list-item:hover { transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.delete-btn { background:#ff4a4a; border:none; color:white; font-size:14px; border-radius:50%; width:32px; height:32px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.dark { background:#1a1a1a; color:#eaeaea; }
.dark .card { background:#262626; }
.dark input { background:#262626; border:1px solid #555; color:white; }
.dark .list-item { background:#333; border-color:#555; }
</style>
</head>
<body>

<h1>
Sitzungsplaner
<button id="darkBtn" style="padding:6px 12px;border-radius:8px;cursor:pointer;">ðŸŒ“</button>
</h1>

<div class="card">
<h2>Neue Sitzung erstellen</h2>
<div class="form-row">
<input id="name" placeholder="Name (PSN)">
<input id="game" placeholder="Spiel">
</div>
<div class="form-row">
<input id="dateFrom" placeholder="Startdatum">
<input id="dateTo" placeholder="Enddatum">
</div>
<div class="form-row">
<input id="timeStart" placeholder="Startzeit">
<input id="timeEnd" placeholder="Endzeit">
<input id="tzoffset" placeholder="UTC Offset">
</div>
<button class="submit" onclick="addSession()">Speichern</button>
</div>

<div class="card">
<h2>SitzungsÃ¼bersicht</h2>
<div id="list">Wird geladen...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase init
const firebaseConfig = { apiKey: "...", authDomain: "...", projectId: "...", storageBucket: "...", messagingSenderId: "...", appId: "..." };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const colRef = collection(db,'sessions');

// Dark mode
document.getElementById('darkBtn').addEventListener('click',()=>document.body.classList.toggle('dark'));

// Flatpickr Datum
import('https://cdn.jsdelivr.net/npm/flatpickr').then(fp=>{
  const lang = navigator.language || 'de';
  const isDE = lang.startsWith('de');
  const options = { dateFormat:'Y-m-d', altInput:true, altFormat:isDE?'d.m.Y':'m/d/Y', allowInput:true, locale:lang };
  fp.default('#dateFrom',options);
  fp.default('#dateTo',options);
});

// Uhrzeit-Erkennung fÃ¼r 12h/24h
const timeInputs = ['timeStart','timeEnd'];
timeInputs.forEach(id=>{
  const input=document.getElementById(id);
  input.addEventListener('input',()=>{
    const val=input.value;
    const ampm = /am|pm/i.test(val);
    input.dataset.use12h = ampm ? 'true':'false';
  });
});

// UTC automatisch
const tzInput = document.getElementById('tzoffset');
tzInput.value = new Date().getTimezoneOffset()/-60;

// Sessions laden
async function loadSessions(){
  const list = document.getElementById('list'); list.innerHTML='';
  try{
    const snapshot = await getDocs(colRef);
    snapshot.docs.forEach(d=>{
      const s = d.data();
      const div = document.createElement('div');
      div.className='list-item';
      div.innerHTML = `<div><b>${s.name}</b> â€“ ${s.game}<br>${s.from} â†’ ${s.to}<br>${s.start} â€“ ${s.end} (UTC${s.tz})</div>
      <button class="delete-btn" onclick="deleteSession('${d.id}')">Ã—</button>`;
      list.appendChild(div);
    });
  }catch(e){ console.error(e); list.innerHTML='Fehler beim Laden'; }
}
loadSessions();

// Session hinzufÃ¼gen
window.addSession = async function(){
  const name=document.getElementById('name').value;
  const game=document.getElementById('game').value;
  const from=document.getElementById('dateFrom')._flatpickr?.input.value||document.getElementById('dateFrom').value;
  const to=document.getElementById('dateTo')._flatpickr?.input.value||document.getElementById('dateTo').value;
  const start=document.getElementById('timeStart').value;
  const end=document.getElementById('timeEnd').value;
  const tz=document.getElementById('tzoffset').value;
  if(!name||!game||!from||!to||!start||!end||tz==='') return alert('Bitte alle Felder ausfÃ¼llen!');
  await addDoc(colRef,{name,game,from,to,start,end,tz});
  await loadSessions();
}

// Admin-LÃ¶schung nur beim Klick
window.deleteSession = async function(id){
  const key = prompt("Admin-Key (fÃ¼r LÃ¶schen)");
  if(key!=="MEIN_GEHEIM_KEY") return alert('Falscher Admin-Key');
  await deleteDoc(doc(db,'sessions',id));
  await loadSessions();
}
</script>
</body>
</html>
