<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sitzungsplaner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
body { font-family:'Inter',sans-serif; background:#eef3ff; margin:0; padding:20px; color:#222; transition: background 0.3s, color 0.3s; }
h1 { text-align:center; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; }
.tabs { display:flex; justify-content:center; margin:20px 0; gap:10px; }
.tab { padding:10px 20px; border-radius:12px; cursor:pointer; background:#4a8bff; color:#fff; font-weight:bold; display:flex; align-items:center; gap:6px; }
.tab.active { background:#2f6edb; }
.card { background:#fff; padding:24px; border-radius:20px; box-shadow:0 6px 20px rgba(0,0,0,0.1); max-width:650px; margin:20px auto; transition: all 0.3s; }
.form-row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
input, select { flex:1 1 150px; padding:8px; border-radius:10px; border:1px solid #ccc; }
.submit { padding:10px 18px; background:#4a8bff; border:none; color:#fff; border-radius:10px; cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:6px; }
.list-item { background:#f1f4ff; padding:14px; border-radius:12px; margin:12px 0; border:1px solid #dce3f5; display:flex; justify-content:space-between; align-items:center; transition: transform 0.2s, box-shadow 0.2s; }
.list-item:hover { transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.delete-btn { background:#ff4a4a; border:none; color:white; font-size:14px; border-radius:50%; width:32px; height:32px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.dark { background:#1a1a1a; color:#eaeaea; }
.dark .card { background:#262626; }
.dark input, .dark select { background:#262626; border:1px solid #555; color:white; }
.dark .list-item { background:#333; border-color:#555; }
</style>
</head>
<body>
<h1>Sitzungsplaner</h1>
<div class="tabs">
<div class="tab active" data-tab="create" onclick="switchTab(event)">Sitzung erstellen</div>
<div class="tab" data-tab="list" onclick="switchTab(event)">Sitzungsübersicht</div>
</div>
<div class="card" id="tab-create">
<h2>Neue Sitzung erstellen</h2>
<div class="form-row">
<input id="name" placeholder="Name (PSN)">
<input id="game" placeholder="Spiel">
</div>
<div class="form-row">
<input id="dateFrom" placeholder="Startdatum">
<input id="dateTo" placeholder="Enddatum">
</div>
<div class="form-row">
<input id="timeStart" placeholder="Startzeit">
<input id="timeEnd" placeholder="Endzeit">
<input id="tzoffset" placeholder="UTC Offset">
</div>
<button class="submit" onclick="addSession()">Speichern</button>
</div>
<div class="card" id="tab-list" style="display:none;">
<h2>Sitzungsübersicht</h2>
<div id="list">Wird geladen...</div>
<button class="submit" style="background:#ff4a4a;margin-top:10px;" onclick="deleteAll()">Alle löschen</button>
</div>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, doc, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = { apiKey: 'AIzaSyBu7TsiZAGJ7kQ8piqfrsyUFalEOM8eSGU', authDomain: 'psn-planen.firebaseapp.com', projectId: 'psn-planen', storageBucket: 'psn-planen.firebasestorage.app', messagingSenderId: '1089591052960', appId: '1:1089591052960:web:069c515084f2105b22d7c5' };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const colRef = collection(db, 'sessions');
const ADMIN_KEY = 'MEIN_GEHEIM_KEY';

window.addEventListener('load', () => { flatpickr('#dateFrom',{dateFormat:'Y-m-d',allowInput:true}); flatpickr('#dateTo',{dateFormat:'Y-m-d',allowInput:true}); loadSessions(); });

function switchTab(e){
 document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
 e.currentTarget.classList.add('active');
 const tab=e.currentTarget.dataset.tab;
 document.getElementById('tab-create').style.display=tab==='create'?'block':'none';
 document.getElementById('tab-list').style.display=tab==='list'?'block':'none';
}

function formatDateLocal(date){ return date ? new Date(date).toLocaleDateString(navigator.language) : ''; }

async function loadSessions(){
 const list = document.getElementById('list');
 list.innerHTML = '';
 try {
   const snapshot = await getDocs(colRef);
   if(snapshot && snapshot.docs.length){
     snapshot.docs.forEach(docu => {
       const s = docu.data();
       list.innerHTML += `<div class='list-item'><div><b>${s.name}</b> – ${s.game}<br>${formatDateLocal(s.from)} → ${formatDateLocal(s.to)}<br>${s.start || ''}–${s.end || ''} (UTC${s.tz || ''})</div><button class='delete-btn' onclick='deleteSession("${docu.id}")'>×</button></div>`;
     });
   } else list.innerHTML = '<div class="list-item">Keine Sitzungen verfügbar.</div>';
 } catch(e){ console.error(e); list.innerHTML = '<div class="list-item">Sitzungen konnten nicht geladen werden.</div>'; }
}

window.deleteSession = async function(id){
 const key = prompt('Admin-Schlüssel eingeben (nur für Löschen)');
 if(key !== ADMIN_KEY) return alert('Falscher Schlüssel! Löschen abgebrochen.');
 try { await deleteDoc(doc(db,'sessions',id)); await loadSessions(); } catch(e){ console.error(e); }
}

window.deleteAll = async function(){
 const key = prompt('Admin-Schlüssel eingeben (nur für Löschen)');
 if(key !== ADMIN_KEY) return alert('Falscher Schlüssel! Löschen abgebrochen.');
 try {
   const snap = await getDocs(colRef);
   for(const d of snap.docs) await deleteDoc(doc(db,'sessions',d.id));
   await loadSessions();
 } catch(e){ console.error(e); }
}

window.addSession = async function(){
 const name=document.getElementById('name').value;
 const game=document.getElementById('game').value;
 const from=document.getElementById('dateFrom').value;
 const to=document.getElementById('dateTo').value;
 const start=document.getElementById('timeStart').value;
 const end=document.getElementById('timeEnd').value;
 const tz=document.getElementById('tzoffset').value || new Date().getTimezoneOffset()/-60;
 if(!name || !game || !from || !to || !start || !end) return alert('Bitte alle Felder ausfüllen');
 await addDoc(colRef,{name,game,from,to,start,end,tz});
 await loadSessions();
}
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</body>
</html>
